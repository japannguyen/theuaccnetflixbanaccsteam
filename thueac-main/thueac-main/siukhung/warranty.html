<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Bảo Hành | VIP STORE</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="top-announcement-bar">Kiểm tra bảo hành - nhập email đã đăng ký</div>
  <nav class="navbar custom-navbar">
    <div class="container-fluid"><a class="navbar-brand" href="index.html">VIP STORE</a></div>
  </nav>

  <main class="container my-5">
    <h2 class="gradient-text mb-4 text-center">Tra cứu bảo hành</h2>

    <div style="max-width:540px;margin:0 auto" class="text-center">
      <input id="wEmail" class="form-control mb-2" placeholder="Nhập email đã dùng để thuê / mua" />
      <button id="checkBtn" class="btn btn-primary-gradient mb-3">Kiểm tra</button>
      <div id="wResult"></div>
    </div>
  </main>

  <script src="app.js"></script>
  <script>
    app.updateNavUI();
    document.getElementById('checkBtn').addEventListener('click', ()=>{
      const email = document.getElementById('wEmail').value.trim();
      const targetEmail = email || app.currentUser();
      if(!targetEmail) return alert('Vui lòng nhập email hoặc đăng nhập trước!');
      const orders = app.getOrdersByEmail(targetEmail);
      const el = document.getElementById('wResult');
      el.innerHTML = '';
      if(orders.length === 0){
        el.innerHTML = '<p class="text-center">Không tìm thấy đơn hàng nào cho email này.</p>';
        return;
      }
      // show nice cards
      orders.forEach(o=>{
        const now = new Date();
        const end = o.endISO ? new Date(o.endISO) : null;
        let status = 'Đang chờ';
        let daysLeft = '';
        if(end){
          const diff = Math.ceil( (end - now)/(1000*60*60*24) );
          if(diff >= 0){ status = 'Còn bảo hành'; daysLeft = diff + ' ngày'; }
          else { status = 'Hết hạn'; daysLeft = 'Đã quá hạn'; }
        }
        const card = document.createElement('div');
        card.className = 'warranty-card';
        card.innerHTML = `<div style="display:flex;align-items:center;gap:12px">
            <div style="width:56px;height:56px;border-radius:10px;background:linear-gradient(90deg,#ff0080,#7928ca);display:flex;align-items:center;justify-content:center;font-weight:700">N</div>
            <div style="flex:1">
              <div style="font-weight:700">${o.name}</div>
              <div style="font-size:13px;color:#ccc">Mua: ${app.formatDate(o.createdISO)} • Trị giá: ${o.price.toLocaleString()}đ</div>
            </div>
            <div style="text-align:right">
              <div style="font-weight:700;color:${status==='Còn bảo hành'?'#0f0':'#f55'}">${status}</div>
              <div style="font-size:13px;color:#ffd">${daysLeft}</div>
            </div>
          </div>`;
        el.appendChild(card);
      });
    });
  </script>
</body>
</html>
